# Presentation:

BaPCod is a prototype code that solves Mixed Integer Programs (MIP) by application of a Dantzig-Wolfe reformulation
technique. The reformulated problem is solved using a branch-and-price (column generation) algorithm. The specificity of
this prototype is to offer a “black-box” implementation of the method:


1. the input is the set of constraints and variables of the MIP in its natural/ compact formulation;
2. the user specifies which of these constraints and variables define the subsystems on which the decomposition is based (it is handy to test different decompositions);
3. the reformulation is automatically generated by the code, without any input from the user to define master columns, their reduced cost, pricing problem, or Lagrangian bound;
4. a default column generation procedure is implemented that relies on an underlying LP/MIP solver to handle master and subproblem but the user can define a specific solver for the pricing problem;
5. a branching scheme that preserves the pricing problem structure is offered by default, it runs based on priorities and directives specified by the user on the original variables;
6. the user can specify custom cut generation callbacks and custom branching callbacks;
7. preprocessing, restricted master and diving primal heuristics, some stabilization techniques, and strong branching are available for use;
8. one can use the VRPSolver extension, which includes a resource constrained shortest path problem (RCSP) solver, and some families of robust and non-robust cut separation and branching functors; these components can be used to devise state-of-the-art branch-cut-and-price algorithms for vehicle routing and related problems.


# Installation:

BaPCod is distributed either on its web-site https://bapcod.math.u-bordeaux.fr/ or via its Git repository. The access to the Git repository is not public, but can be requested from ruslan.sadykov@inria.fr. 

If you get BaPCod on its web-site, the RCSP library (which implements the VRPSolver extension) is included in the rcsp.zip file, so you need to extract it inside the Tools folder before using it, and it does not require any special installation.

If you clone BaPCod from its Git repository, you need to put the RCSP library in `<BapcodFramework path>/Tools/rcsp`. RCSP library can be obtained by request from 
ruslan.sadykov@inria.fr (either in the compiled form or via the Git repository).

Other requirements are:
	    
- CMake 3.12 minimum (use version 3.20 and above to avoid Boost related warnings);
- Boost 1.76 (versions above can potentially be used, but they were not tested);
- Lemon 1.3.1; 
- either CPLEX 12.8 and above, or COIN-OR CLP (version 1.17.7 is tested);
- RapidJSON (needed only for VRPSolverEasy interface).

CMake and IBM ILOG CPLEX Optimization Studio should be installed in the standard way. See https://github.com/coin-or/Clp for installation instructions for the COIN-OR CLP solver. See the user guide how to switch between the solvers. 

## Mac OS or Linux:

Run the following commands from the BapcodFramework folder to install Boost and LEMON libraries.

	wget -P Tools/ https://boostorg.jfrog.io/artifactory/main/release/1.76.0/source/boost_1_76_0.tar.gz
	wget -P Tools/ http://lemon.cs.elte.hu/pub/sources/lemon-1.3.1.tar.gz
	bash Scripts/shell/install_bc_lemon.sh
	bash Scripts/shell/install_bc_boost.sh

On Mac computers with Apple Silicon processors, compilation should be done for x86_64 architecture, as CPLEX does not support Apple Silicon. Thus different scripts for installation of LEMON and Boost should be called:

	bash Scripts/shell/install_bc_lemon_mac_m1.sh
	bash Scripts/shell/install_bc_boost_mac_m1.sh

Alternatively, you can use an existing Boost installation by specifying BOOST_ROOT environment variable (again, Boost should be compiled for the x86_64 architecture on M1 Apple computers):

	export BOOST_ROOT=<path to Boost> 

If you plan to generate the BaPCod shared library to be used with the VRPSolverEasy Python package, you need to install	Rapidjson library. For that, clone it from https://github.com/Tencent/rapidjson/ to `<BapcodFramework path>/Tools/rapidjson`.

If you use CPLEX solver, set the environment variable CPLEX_ROOT to the path to the IBM ILOG CPLEX Optimization Studio (and not to the CPLEX itself):

	export CPLEX_ROOT=<path to CPLEX Studio root>

If you use CLP solver, set the environment variable CLP_ROOT:

	export CLP_ROOT=<path to CLP>

Now you are ready to compile BaPCod. For that, run the following commands from the BapcodFramework folder:

	mkdir build
	cd build
	cmake -DCMAKE_BUILD_TYPE=Release ..
	
	or 
	
	cmake -DCMAKE_BUILD_TYPE=Release -Wno-dev       -DCPLEX_INCLUDE_DIR=$CPLEXINCDIR       -DCPLEX_LIBRARY_DIR=$CPLEXLIBDIR       -DCONCERT_INCLUDE_DIR=$CONCERTINCDIR       -DCONCERT_LIBRARY_DIR=$CONCERTLIBDIR       -DGUROBI_HOME=$GUROBI_HOME       ..
	
	make -j8 bapcod

If you have error

	/usr/bin/ld: cannot find -lz

on Linux during linking, you need to install zlib1g-dev library first:

	sudo apt-get install zlib1g-dev

To test installation, you can run a demo distributed with BaPCod. For example to run VertexColoring demo, run the
following commands from the BapcodFramework folder (you need Python installed to run tests)

	cd build/Demos/VertexColoring
	make -j8
	sh ./tests/runTests.sh 	

To check whether the RCSP library is properly installed and VRPSolver extension is enabled, run from the BapcodFramework folder

	cd build/Demos/VehicleRoutingWithTimeWindows 
	make -j8
	sh ./tests/runTests.sh 	

We recommend using CLion IDE (https://www.jetbrains.com/clion) when working with BaPCod in Linux and MacOS. Free
educational licences are available: https://www.jetbrains.com/community/education.

## Installation on Windows 10 with WSL

It is possible to install and BaPCod on Windows 10 the same way as on Linux using WSL (Windows Subsystem for
Linux). After installing WSL and Linux distribution, run the following commands inside Linux terminal

	sudo apt-get update
	sudo apt install cmake
	sudo apt install default-jre
	sudo ./ILOG_COS_20.10_LINUX_X86_64.bin # to install Cplex
	sudo apt install g++
	sudo apt-get install zlib1g-dev
	sudo apt-get install build-essential gdb
	sudo apt install python

Afterwords, proceed the same way as described above for the Linux installation.

You may use VS Code IDE to work with BaPCod on Windows 10 with WSL, see
https://code.visualstudio.com/docs/cpp/config-wsl for details.

## Installation on Windows 10 with Visual Studio

These installation instructions have been tried with Visual Studio 19.

To install Boost, download file
https://boostorg.jfrog.io/artifactory/main/release/1.76.0/source/boost_1_76_0.zip, extract it to
`<BapcodFramework path>/Tools/boost_1_76_0`, and then run

	cd <BapcodFramework path>\Tools\boost_1_76_0
	bootstrap
	.\b2

To install LEMON, download http://lemon.cs.elte.hu/pub/sources/lemon-1.3.1.zip, extract it to a folder and then run from
this folder in PowerShell with administrative rights

	cmake -G "Visual Studio 16 2019" -A x64 -B "build"
	cmake --build build --config Release --target INSTALL

If you do not have administrative rights the first command should be

	cmake -G "Visual Studio 16 2019" -A x64 -B "build"  -DCMAKE_INSTALL_PREFIX="<path to install folder>"

If you plan to generate the BaPCod shared library to be used with the VRPSolverEasy Python package, you need to install	Rapidjson library. For that, clone it from https://github.com/Tencent/rapidjson/ to `<BapcodFramework path>/Tools/rapidjson`.

If Cplex, CLP, or LEMON are installed to non-default locations, you should set environment variables CPLEX_ROOT, CLP_ROOT, and LEMON_ROOT before compiling BaPCod. To compile BaPCod, run the following commands from the BapcodFramework folder:

	cmake -G "Visual Studio 16 2019" -A x64 -B "build"
	cmake --build build --config Release --target bapcod

To compile and link a demo (for example VertexColoringDemo), run

	cmake --build build --config Release --target VertexColoringDemo

To test installation, you can run

	cd .\build\Demos\VertexColoringDemo\
	.\bin\Release\VertexColoringDemo.exe -b .\config\bcBranchAndPrice.cfg -a .\config\app.cfg -i .\data\mug88_25.col

If you want to use Debug mode, LEMON should also be built using Debug configuration.

To use Visual Studio IDE, open file `<BapcodFramework path>/build/BapcodFramework.sln`.

## Applications:	

To create an application, you can copy the directory with one of the demos to `<BaPCodFramework path>/Applications`,
rename this directory to `<ApplicationName>`, change the source code in `<BaPCodFramework
path>/Applications/<ApplicationName>/include` and `<BaPCodFramework path>/Applications/<ApplicationName>/src` as needed,
update the configuration files in `<BaPCodFramework path>/Applications/<ApplicationName>/config`, replace instance files
in `<BaPCodFramework path>/Applications/<ApplicationName>/data`, change tests in `<BaPCodFramework path>/Applications/<ApplicationName>/tests`.

To run the application, add `<ApplicationName>` to `<BaPCodFramework path>/Applications/CMakeLists.txt` inside `add_subdirectories()`, and run the following from the BaPCodFramework folder on Linux and Mac OS

    cd build
	cmake ..
	cd Applications/<ApplicationName>
	make 
	bin/<ApplicationName> -b <path to BaPCod config file> -a <path to application config file> -i <path to instance file>

On Windows: 

	cmake -G "Visual Studio 16 2019" -A x64 -B "build"
	cmake --build build --config Release --target <AppName>
	cd build/Applications/<AppName> 
	bin/Release/<AppName>.exe -b <BaPCod_config> -a <app_config> -i <instance> 


# Producing BaPCod shared library:

BaPCod shared library is needed for the Julia interface for VRPSolver (https://github.com/inria-UFF/BaPCodVRPSolver.jl) and for the VRPSolverEasy Python package (https://github.com/inria-UFF/VRPSolverEasy).

On MacOS or Linux, run the following commands

	cd build
	make -j8 bapcod-shared

On Windows, run 

	cmake --build build --config Release --target bapcod-shared

This will produce shared library file `<BaPCodFramework path>/build/Bapcod/libbapcod-shared.so` on Linux, `<BaPCodFramework path>/build/Bapcod/libbapcod-shared.dylib` on Mac OS, and `<BaPCodFramework path>/build/Bapcod/Release/bapcod-shared.dll` on Windows. 

# User Guide:	

The latest user guide is available at the BaPCod web-page : https://bapcod.math.u-bordeaux.fr

# Release Notes:	

v0.77 
- Support for VRPSolverEasy Python library
- Better support for the COIN-OR CLP solver
- Bug fixes

v0.74 
- Experimental support of COIN-OR CLP solver (which can be used instead of CPLEX). Attention: performance may be degraded. 

v0.73 
- A richer graph interface: arcs and vertices can belong to several elementarity/packing sets (VRPSolver extension) 

v0.72
- Possibility to give names to arcs and vertices (VRPSolver extension) 
- Bug fixes in the C dynamic library interface (VRPSolver extension)
- A function in Model to get enumerated subproblem solutions
- Support of Apple computers with M1 processor (through Rosetta)

v0.71
- Support for full-memory rank-1 cuts (VRPSolver extension) 
- Verification of the RCSP library version in CMake
- Bug fixes

v0.70
- An additional output with cut separation round statistics (VRPSolver extension)

0.69
- Support of update of the objective, variables bounds, and constraints right-hand-sides when resolving a MIP
- More statistics about active and separated cuts
- Bug fixes

0.68
- Possibility of passing a debug solution in a file
- Possibility to run without a file with parameters
- Bug fixes

0.67
- Bug fixes
